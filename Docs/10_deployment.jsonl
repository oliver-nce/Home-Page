{"chunk_id": "10_deployment__database-migrations__001", "module": "10_deployment", "source_url": "https://docs.frappe.io/framework/v15/user/en/database-migrations", "title": "Database Migrations", "section_heading": "Schema changes", "content": "## Schema changes\n\nA project often undergoes changes related to database schema during course of\nits development. It may also require patching of existing data. Frappe comes\nwith a migration and patch system tools to handle these scenarios.\n\nWhen there are schema changes in your app, to migrate your existing site's\ndatabase to the new schema, you should run the command.\n\n```python\nbench --site [sitename] migrate\n```\n\n### Schema changes\n\nYou can edit a DocType to add, remove or change fields. On saving a DocType, a\nJSON file containing the DocType data is added to source tree of your app. When\nyou add an app to a site, the DocTypes are installed (database tables are\ncreated) using this JSON file.\n\n> For making schema changes, you must enable Developer Mode.\n\nOn running a `migrate`, all apps migrate to their current version. First, we run the \"before\\_migrate\" hook to sync user permissions. Then the actual patches are run, which migrate the various apps. After this, we sync the following components:\n\n* Database Schema\n* Background Jobs\n* Fixtures \\_[[Read more](/framework/v14/user/en/python-api/hooks#fixtures)]\\_\n* Dashboards, Desktop Icons and Web Pages\n* Updates Translations\n* Rebuild Search Index for all routes\n\nParticularly for DocTypes, we compare the MD5 hash of each DocType JSON with the hashes we have stored in the DocType database table. If the hashes don't match, we reload the particular DocType. This technique is called checksum comparison, you can learn more about it [here](https://www.computerworld.com/article/2819393/unix-tip--comparing-files-with-checksums.html). Finally, we run a \"after\\\\_migrate\" hook to finish the migration. You can find the commands run for the individual processes at [bench-site-commands](bench/frappe-commands#site-commands)\n\n> Note: Up Until `v13` DocTypes were synced based on the modified timestamps in the JSON file. This method was error-prone so we moved to the more robust hash comparison method. You can read more about it [here](https://github.com/frappe/frappe/pull/14246#issuecomment-928942292)\n\nWhen you remove or rename fields in the DocType, the corresponding database\ncolumns are not removed from the database table, but they will not be visible in\nthe form view. This is done to avoid any potential data loss situations and to\nallow you write related data migrations (patches) which might need values from\nold fields.\n\n> Frappe doesn't support reverse schema migrations.\n\n### Data Migrations\n\nOn introducing data related changes, you might want to run one off scripts to\nchange existing data to match expectations as per new code. We call these scripts **patch** in frappe.", "content_type": "mixed", "has_code": true, "token_count": 663}
{"chunk_id": "10_deployment__database-migrations__002", "module": "10_deployment", "source_url": "https://docs.frappe.io/framework/v15/user/en/database-migrations", "title": "Database Migrations", "section_heading": "Writing a patch", "content": "## Writing a patch\n\nTo write a patch, you must write an `execute` method in a python script and add\nit to `patches.txt` of your app.\n\nIt is recommended to make a file with a patch number and name in its path and\nadd it to a patches package (directory) in your app. You can then add a line\nwith dotted path to the patch module to `patches.txt`.\n\nThe directory structure followed in Frappe is as below\n\n```python\nfrappe\n\u2514\u2500\u2500 patches\n \u2514\u2500\u2500 v12_0\n \u2514\u2500\u2500 my_awesome_patch.py\n```\n\nThe patch can then be added to `patches.txt` by its dotted path.\n\n```python\nfrappe.patches.v12_0.my_awesome_patch\n```\n\n### Schema during patch\n\nThe DocType meta available in the execute function will be as per the old JSON.\nThis is so that you can write migration code assuming you still have the old fields.\nAfter the patch is run, the new schema is applied to the DocType.\n\nIf you want to have the new schema during your patch execution, use the `reload_doc` method.\n\n```python\nimport frappe\n\ndef execute():\n frappe.reload_doc(module_name, \"doctype\", doctype_name)\n\n # your patch code here\n```", "content_type": "mixed", "has_code": true, "token_count": 266}
{"chunk_id": "10_deployment__database-migrations__003", "module": "10_deployment", "source_url": "https://docs.frappe.io/framework/v15/user/en/database-migrations", "title": "Database Migrations", "section_heading": "Post-Model sync patches [v14 / develop branch only]", "content": "## Post-Model sync patches [v14 / develop branch only]\n\nOften your patch might not require access to database schema before DocType models are synced with database. In such cases it's better to keep the patch in `[post_model_sync]` section of `patches.txt`.\n\n`patches.txt` supports INI-like file format where two sections specify when a patch should run - before or after doctype schema migration. Post model sync patches do not require reloading any doctypes as all doctypes are reloaded before executing them. Here is example of such patches.txt file:\n\n```python\n[pre_model_sync]\napp.module.patch1\napp.module.patch2\n\n[post_model_sync]\napp.module.patch3\napp.module.patch4\n```\n\n### One off Python statements\n\nYou can also add one off python statements in `patches.txt` using the syntax,\n\n```python\nfrappe.patches.v12_0.my_awesome_patch\nexecute:frappe.delete_doc('Page', 'applications', ignore_missing=True)\n```\n\n### Patch execution order\n\nPatches run in the order they are defined. All lines in `patches.txt` have to be\nunique. If a patch has been run before, it won't run again. If you want to run a\npatch again, add a comment that will make the line appear as new.\n\nFor Example,\n\n```python\nfrappe.patches.v12_0.my_awesome_patch #2019-09-08\n```", "content_type": "mixed", "has_code": true, "token_count": 311}
{"chunk_id": "10_deployment__production-setup__001", "module": "10_deployment", "source_url": "https://docs.frappe.io/framework/v15/user/en/production-setup", "title": "Production Setup", "section_heading": "Install Bench", "content": "## Install Bench\n\n[Bench](https://github.com/frappe/bench) is the CLI tool to manage deployments\nfor sites based on Frappe Framework. Here are steps to deploy your frappe based\nsites on production.\n\n### Install Bench\n\nDeploying frappe sites is not too different from setting it up on your local\nsystem. Install bench using the [Easy\nInstall](https://github.com/frappe/bench#easy-install-script) script if your server is\none of the supported linux distributions (Debian, Ubuntu, CentOS). Make sure you\npass the `--production` flag to the script.\n\n```python\nsudo python install.py --production --user [frappe-user]\n```\n\n### Setup sites and apps\n\n```python\n# change directory to frappe-bench\ncd frappe-bench\n\n# create a new site\nbench new-site example.com\n\n# download frappe apps or your custom-apps\nbench get-app erpnext\nbench get-app https://github.com/yourremote/yourapp.git\n\n# install apps onto your site\nbench --site example.com install-app erpnext yourapp\n```", "content_type": "mixed", "has_code": true, "token_count": 240}
{"chunk_id": "10_deployment__production-setup__002", "module": "10_deployment", "source_url": "https://docs.frappe.io/framework/v15/user/en/production-setup", "title": "Production Setup", "section_heading": "Check supervisor", "content": "## Check supervisor\n\nIf everything is setup properly, you should see frappe processes as the\nsupervisor status output.\n\n```python\n$ sudo supervisorctl status\nfrappe-bench-redis:frappe-bench-redis-cache RUNNING pid 6467, uptime 10 days, 8:12:09\nfrappe-bench-redis:frappe-bench-redis-queue RUNNING pid 6466, uptime 10 days, 8:12:09\nfrappe-bench-redis:frappe-bench-redis-socketio RUNNING pid 6468, uptime 10 days, 8:12:09\nfrappe-bench-web:frappe-bench-frappe-web RUNNING pid 8856, uptime 10 days, 4:32:18\nfrappe-bench-web:frappe-bench-node-socketio RUNNING pid 8858, uptime 10 days, 4:32:18\nfrappe-bench-workers:frappe-bench-frappe-default-worker-0 RUNNING pid 8823, uptime 10 days, 4:32:19\nfrappe-bench-workers:frappe-bench-frappe-long-worker-0 RUNNING pid 8824, uptime 10 days, 4:32:19\nfrappe-bench-workers:frappe-bench-frappe-schedule RUNNING pid 8822, uptime 10 days, 4:32:19\nfrappe-bench-workers:frappe-bench-frappe-short-worker-0 RUNNING pid 8825, uptime 10 days, 4:32:19\n```\n\nIf you own `example.com` and it is mapped to the IP Address of your server, your\nsite should be live on `example.com`.", "content_type": "mixed", "has_code": true, "token_count": 274}
{"chunk_id": "10_deployment__production-setup__003", "module": "10_deployment", "source_url": "https://docs.frappe.io/framework/v15/user/en/production-setup", "title": "Production Setup", "section_heading": "Updating", "content": "## Updating\n\nTo update your sites, just run the following command. It will update all of your\napps (`git pull`), run patches on all sites, build JS and CSS assets and restart\nsupervisor.\n\n```python\n# update everything\nbench update\n\n# update apps\nbench update --pull\n\n# run patches only\nbench update --patch\n\n# build assets only\nbench update --build\n\n# update bench (the cli)\nbench update --bench\n\n# update python packages and node_modules\nbench update --requirements\n```\n\n### Redis Namespaces\n\nNamespaces help to secure user's data. Multiple benches can use the same Redis instance without worrying about namespace conflicts. You can enable Redis namespaces in Frappe by following the given setup (for now Frappe supports namespaces for Redis Queue at bench level).\n\nYou can create Redis users and configure Frappe with credentials using bench create-rq-users CLI.\n\n```python\nbench create-rq-users\n\n# Optional flags\n# --use-rq-auth Enable Redis authentication for all bench sites\n# --set-admin-password sets default user admin password\n```\n\nAbove command generates an ACL file in the bench configs directory. Make sure that Redis\\_queue.conf file is configured to use an acl file if not already (Alternatively, run `bench setup redis` with the latest version of the Bench CLI).\n\n```python\naclfile [frappe-bench-absolute-path]/config/redis_queue.acl\n```", "content_type": "mixed", "has_code": true, "token_count": 338}
{"chunk_id": "10_deployment__zero__downtime_migrations__001", "module": "10_deployment", "source_url": "https://docs.frappe.io/framework/v15/user/en/zero*_downtime_migrations", "title": "Zero* Downtime Migrations", "section_heading": "How does this work", "content": "## How does this work\n\nZero\\* downtime migrations let the site run in read only mode during site upgrade process. This means your static site, dynamic pages which only need to read data can continue to work without any noticable difference. Any actions that requires writing to database will be disabled and only resume when upgrade is finished.\n\n### How does this work\n\nZero downtime migration utilizes one of following two means to enable read-only mode:\n\n1. Using read-replicas.\n2. Using \"read only transactions\" which are provided by databases.\n\nIn either case writes on your database are disabled until maintenance mode is lifted.\n\nBoth web pages and Desk will show persisten read only warnings during updates. All forms are also made read only so you can not modify any data.\n\n![zero downtime migration](/private/files/zero-downtime-migration.png)\n\n### Caveats to keep in mind\n\n* Not all apps automatically support this feature. They might behave erratically if they are not designed to work in read only mode.\n* During update database schema changes, client side app is updated so you'll ocassionally face some glitches. These can not be fully avoided, the intent behind this feature is only to reduce the impact of downtime.\n\n### Enabling Read Only Mode during upgrades\n\n1. [Optional/Recommended] - Setup a read replica by following the [replication guide](https://frappeframework.com/docs/v14/user/en/guides/database-settings/setup-read-from-secondary-db)\n2. Edit your site config to enable this feature. `bench --site develop set-config allow_reads_during_maintenance 1`\n\n### Supporting read only mode in your app\n\nIf you are an app developer and want to add support for this feature in your app then you need to modify your app\n\n### Server side changes\n\nYou can use `frappe.flags.read_only` to disable or modify behaviour in read only mode.\n\nExample: Logging page visits\n\n```python\n@frappe.whitelist()\ndef log_visit():\n    if frappe.flags.read_only:\n        return\n\n    doc = frappe.new_doc(\"Doc Visit\")\n    doc.insert()\n```", "content_type": "mixed", "has_code": true, "token_count": 508}
{"chunk_id": "10_deployment__zero__downtime_migrations__002", "module": "10_deployment", "source_url": "https://docs.frappe.io/framework/v15/user/en/zero*_downtime_migrations", "title": "Zero* Downtime Migrations", "section_heading": "Jinja / Client side page changes", "content": "## Jinja / Client side page changes\n\nYou should ideally update the UI to indicate that your app is in read only mode and write-actions can not be performed right now.\n\nWebsite context includes `read_only_mode` key in context by default, you can use this to add warning or toggle features on your pages conditionally. Example:\n\n```python\n<!-- some html page -->\n{% if read_only_mode %}\n    <div class=\"alert\">Site is running in read only mode. Full functionality will be restored soon.</div>\n{% endif %}\n<!-- other content -->\n```", "content_type": "mixed", "has_code": true, "token_count": 132}
{"chunk_id": "10_deployment__rate-limiting__001", "module": "10_deployment", "source_url": "https://docs.frappe.io/framework/v15/user/en/rate-limiting", "title": "Rate Limiting", "section_heading": "", "content": "Frappe framework has out of the box support for rate-limiting HTTP requests.\n\nFrappe framework implements fixed window rate-limiting based on time consumed by requests. The limit is enforced on the sum of time taken by all HTTP requests made in the configured window. The cycle resets after every `window` seconds, for instance, setting `window` to 3600 seconds will reset the usage counter to 0 at the beginning of every hour based on site's timezone.\n\n**Note:** Requests over limit are not processed and are sent HTTP `429` (Too Many Requests) response.\n\nYou can enable rate limiting on your site by adding configuration similar to the following in `site_config.json`:\n\n```python\n{\n \"rate_limit\": {\n \"limit\": 600,\n \"window\": 3600\n }\n}\n```\n\n| Key | Description |\n| --- | --- |\n| `limit` | Maximum amount of time permitted to use in the rate limit window (in seconds). |\n| `window` | Size of the rate limit window (in seconds). |\n\nThe returned HTTP headers of every HTTP request show the current rate limit status, e.g.\n\n```python\ncurl -i https://frappe.io/docs\nHTTP/1.1 200 OK\nX-RateLimit-Limit: 600000000\nX-RateLimit-Remaining: 518060453\nX-RateLimit-Reset: 3513\nX-RateLimit-Used: 100560\n```\n\nIn case of requests made after configured limits are exhausted, HTTP `429` response is returned along with the rate limit status:\n\n```python\ncurl -i https://frappe.io/docs\nHTTP/1.1 429 TOO MANY REQUESTS\nX-RateLimit-Limit: 600000000\nX-RateLimit-Remaining: 0\nX-RateLimit-Reset: 1242\nRetry-After: 1242\n```\n\n| Header | Description |\n| --- | --- |\n| Retry-After | Time remaining till the current rate limit window resets (in seconds). |\n| X-RateLimit-Limit | Time permitted to use in a rate limit window (in microseconds). |\n| X-RateLimit-Remaining | Time remaining (to be used) in the current rate limit window (in microseconds). |\n| X-RateLimit-Reset | Time remaining till the current rate limit window resets (in seconds). |\n| X-RateLimit-Used | Time used for processing the current request (in microseconds). |", "content_type": "mixed", "has_code": true, "token_count": 500}
{"chunk_id": "10_deployment__guides__deployment__packages__001", "module": "10_deployment", "source_url": "https://docs.frappe.io/framework/v15/user/en/guides/deployment/packages", "title": "Packages", "section_heading": "Creating a Package", "content": "## Creating a Package\n\n> New in [Version 14](https://github.com/frappe/frappe/pull/14123)\n\nPackages are light weight apps that you can directly build from the Framework UI. A Package is very much like an app and a collection of Module Defs.\n\nYou can make apps directly from the Framework UI (without using the command-line) using DocTypes, Server Scripts, Web Page etc. High quality apps can be build from the Framework directly. These apps can be bundled in a \"Package\" and then imported to other sites.\n\nTo add a module to a package, you have to set its \"Package\" property. This is available for \"Custom\" Module Defs\n\n### Creating a Package\n\nYou can create a new Package by creating a Package object. You can set a README and a LICENSE. A Package is designed in a way that it can be pushed to a git repository.\n\nOnce you have created a package, you can add your custom Module Defs to that package.\n\n![Package](/files/package.png)\n\n### Making a Package Release\n\nA **Package Release** will export all the package modules in the `[bench]/sites/[site]/packages` folder like an app, and then bundle the folder in a gzipped tarfile `[package]-[version].tar.gz`\n\nYou can then download the package release and import it in another site\n\n![Package Release](/files/package-release.png)", "content_type": "prose", "has_code": false, "token_count": 319}
{"chunk_id": "10_deployment__guides__deployment__packages__002", "module": "10_deployment", "source_url": "https://docs.frappe.io/framework/v15/user/en/guides/deployment/packages", "title": "Packages", "section_heading": "Importing a Package", "content": "## Importing a Package\n\nYou can create a **Package Import** and attach the exported package on a new site. If you check \"Activate\", the package will be extracted into the `[bench]/sites/[sitename]/packages` folder (existing files will be overwritten).\n\nThe system will then *migrate* this package to the database similar to how an app migration works. Files that have not been changed will be skipped unless the \"Force\" check is applied.\n\nA log is created with the output.\n\n![Package Import](/files/package-import.png)", "content_type": "prose", "has_code": false, "token_count": 129}
{"chunk_id": "10_deployment__guides__deployment__email-notifications-for-failed-background-jobs__001", "module": "10_deployment", "source_url": "https://docs.frappe.io/framework/v15/user/en/guides/deployment/email-notifications-for-failed-background-jobs", "title": "Email Notifications For Failed Background Jobs", "section_heading": "", "content": "Frappe handles failure of jobs in the following way,\n\n1. If a job fails, (raises exception), it's logged in Scheduler Log and\u00a0 `logs/worker.error.log`.\n2. Keeps a lock file and would not run anymore if lock file is there.\n3. Raises LockTimeoutError in case the lock file is more than 10 minutes old.\n\nYou can configure email notification for scheduler errors. By writing a file, `sites/common_site_config.json` with content\n\n```python\n{\n  \"celery_error_emails\": {\n \"ADMINS\": [\n [\n \"Person 1\",\n \"person1@example.com\"\n ],\n [\n \"Person2 \",\n \"person2@example.com\"\n ]\n ],\n \"SERVER_EMAIL\": \"exceptions@example.com\"\n }\n}\n```\n\nOne limitation is that it'll use local mailserver on port 25 to send the emails.", "content_type": "mixed", "has_code": true, "token_count": 174}
{"chunk_id": "10_deployment__guides__deployment__how-to-migrate-doctype-changes-to-production__001", "module": "10_deployment", "source_url": "https://docs.frappe.io/framework/v15/user/en/guides/deployment/how-to-migrate-doctype-changes-to-production", "title": "How To Migrate Doctype Changes To Production", "section_heading": "1. DocType / Schema Changes", "content": "## 1. DocType / Schema Changes\n\nIf you are in `developer_mode`, the `.json` files for each **DocType** are automatically updated.\n\nWhen you update in your production using `--latest` or `bench update`, these changes are updated in the site's schema too!\n\n### 2. Permissions\n\nPermissions do not get updated because the user may have changed them. To update permissions, you can add a new patch in the `patches.txt` of your app.\n\nexecute:frappe.permissions.reset\\_perms(\"[docype]\")", "content_type": "prose", "has_code": false, "token_count": 119}
{"chunk_id": "10_deployment__guides__deployment__migrations__001", "module": "10_deployment", "source_url": "https://docs.frappe.io/framework/v15/user/en/guides/deployment/migrations", "title": "Migrations", "section_heading": "Schema changes", "content": "## Schema changes\n\nA project often undergoes changes related to database schema during course of\nits life. It may also be required patch existing data. Frappe bundles tools to\nhandle these scenarios.\n\nWhen you pull updates from any Frappe app (including Frappe), you should run\n`bench migrate` to apply schema changes and data migrations if any.\n\n### Schema changes\n\nYou can edit a DocType to add, remove or change fields. On saving a DocType,\na JSON file containing the DocType data is added to source tree of your app.\nWhen you add an app to a site, the DocTypes are installed using this JSON file.\nFor making schema changes, it's required to set `developer_mode` in the\nconfiguration.\n\nOn running a sync (`bench migrate`), doctypes in the system are synced to\ntheir latest version from the JSON files in the app.\n\nNote: Fields are soft deleted ie. the columns are not removed from the database\ntable and however, they will not be visible in the documents. This is done to\navoid any potential data loss situations and to allow you write related data\nmigrations which might need values from deleted fields.\n\nNote: Frappe doesn't support reverse schema migrations.", "content_type": "prose", "has_code": false, "token_count": 291}
{"chunk_id": "10_deployment__guides__deployment__migrations__002", "module": "10_deployment", "source_url": "https://docs.frappe.io/framework/v15/user/en/guides/deployment/migrations", "title": "Migrations", "section_heading": "Data Migrations", "content": "## Data Migrations\n\nOn introducing data related changes, you might want to run one off scripts to\nchange existing data to match expectations as per new code.\n\nTo add a data migration to your code, you will have to write an `execute`\nfunction to a python module and add it to `patches.txt` of your app.\nAlternatively, you can create a new patch interactively by using following command:\n\n```python\n$ bench create-patch\nSelect app for new patch (frappe, hrms, ecommerce_integrations, erpnext): frappe\nProvide DocType name on which this patch will apply: User\nDescribe what this patch does: Improve Indexing\nProvide filename for this patch [improve_indexing.py]:\nPatch folder '/home/ankush/benches/develop/apps/frappe/frappe/core/doctype/user/patches' doesn't exist, create it? [Y/n]: y\nCreated /home/ankush/benches/develop/apps/frappe/frappe/core/doctype/user/patches/improve_indexing.py and updated patches.txt\n```\n\nIt is recommended to make a file with a patch number and name in its path and\nadd it to a patches package (directory) in your app. You can then add a line\nwith dotted path to the patch module to `patches.txt`.\n\nThe directory structure followed in Frappe is as below\n\nfrappe\n\u2514\u2500\u2500 patches\n\u2514\u2500\u2500 4\\_0\n\u2514\u2500\u2500 my\\_awesome\\_patch.py\n\nThe patch can be added to `patches.txt` by adding a line like\n\nfrappe.patches.4\\_0.my\\_awesome\\_patch\n\nThe metadata ie. DocType available in the execute function will be the latest as\nper JSON files in the apps. However, you will not be able to access metadata of\nany previous states of the system.\n\n### One off Python statements\n\nYou can also add one off python statements in `patches.txt` using the syntax,\nexecute:{python statement}\n\nFor example,\nexecute:frappe.get\\_doc(\"User\", \"Guest\").save()\n\nNote: All lines in patches.txt have to be unique. If you want to run a line\ntwice, you can make it unique by adding a distinct comment.\n\nFor Example,\n\nexecute:frappe.installer.make\\_site\\_dirs() #2014-02-19", "content_type": "mixed", "has_code": true, "token_count": 485}
{"chunk_id": "10_deployment__guides__deployment__how-to-enable-social-logins__001", "module": "10_deployment", "source_url": "https://docs.frappe.io/framework/v15/user/en/guides/deployment/how-to-enable-social-logins", "title": "How To Enable Social Logins", "section_heading": "Login screen with Social Logins enabled", "content": "## Login screen with Social Logins enabled\n\nUse Facebook, Google or GitHub authentication to login to Frappe, and your users will be spared from remembering another password.\n\nThe system uses the **Email Address** supplied by these services to **match with an existing user** in Frappe. If no such user is found, **a new user is created** of the default type **Website User**, if Signup is not disabled in Website Settings. Any System Manager can later change the user type from **Website User** to **System User**, so that the user can access the Desktop.\n\n### Login screen with Social Logins enabled\n\n![Login screen with Social Logins enabled](/files/social-logins.png)\n\nTo enable these signups, you need to have **Client ID** and **Client Secret** from these authentication services for your Frappe site. The Client ID and Client Secret are to be set in **Desktop > Integration > Authentication > Social Login Key > Client ID** and **Desktop > Integration > Authentication > Social Login Key > Client Secret**. Here are the steps to obtain these credentials.\n\n> Use **https://** if your site is HTTPS enabled.\n\n---", "content_type": "prose", "has_code": false, "token_count": 279}
{"chunk_id": "10_deployment__guides__deployment__how-to-enable-social-logins__002", "module": "10_deployment", "source_url": "https://docs.frappe.io/framework/v15/user/en/guides/deployment/how-to-enable-social-logins", "title": "How To Enable Social Logins", "section_heading": "Frappe", "content": "## Frappe\n\nThis is assuming you have two 2 sites built on Frappe Framework. Site A is `https://sitea.com` and Site B is `https://siteb.com`. You want to use `https://sitea.com` as the login provider and setup Social Login on `https://siteb.com` to login via `https://sitea.com`.\n\n1. Go to `https://sitea.com` which is the login provider\n2. Go to OAuth Client list\n3. Create a new OAuth Client\n4. Enter the App Name (Something that identifies Site B)\n5. In Redirect URIs and Default Redirect URI enter `https://siteb.com/api/method/frappe.www.login.login_via_frappe`\n6. After you save the document, App Client ID and App Client Secret will be generated\n7. Go to `https://siteb.com` where you want to setup Social Login\n8. Go to Social Login Key and create a new one\n9. Enter Client ID and Client Secret obtained in step 6\n10. Select Social Login Provider as Frappe\n11. Enter `https://sitea.com` as Base URL and then save the document.", "content_type": "prose", "has_code": false, "token_count": 233}
{"chunk_id": "10_deployment__guides__deployment__how-to-enable-social-logins__003", "module": "10_deployment", "source_url": "https://docs.frappe.io/framework/v15/user/en/guides/deployment/how-to-enable-social-logins", "title": "How To Enable Social Logins", "section_heading": "Facebook", "content": "## Facebook\n\n1. Go to <https://developers.facebook.com>\n2. Click on Apps (topbar) > New App, fill in the form.\n3. Go to Settings > Basic, set the **Contact Email** and save the changes.\n4. Go to Settings > Advanced, find the field **Valid OAuth redirect URIs**, and enter:\n   **http:///api/method/frappe.www.login.login\\\\_via\\\\_facebook**\n5. Save the changes in Advance tab.\n6. Go to Status & Review and switch on \"Do you want to make this app and all its live features available to the general public?\"\n7. Go to Dashboard, click on the show button besides App Secret, and copy the App ID and App Secret into **Desktop > Integration > Authentication > Social Login Key > Client ID** and **Desktop > Integration > Authentication > Social Login Key > Client Secret**\n\n---\n\n### Google\n\n1. Go to <https://console.developers.google.com>\n2. Create a new Project and fill in the form.\n3. Click on APIs & Auth > Credentials > Create new Client ID\n4. Fill the form with:\n\n* Web Application\n* Authorized JavaScript origins as **http://**\n* Authorized redirect URI as\n  **http:///api/method/frappe.www.login.login\\\\_via\\\\_google**\n\n1. Go to the section **Client ID for web application** and copy the Client ID and Client Secret into **Desktop > Integration > Authentication > Social Login Key > Client ID**\n\n---", "content_type": "prose", "has_code": false, "token_count": 325}
{"chunk_id": "10_deployment__guides__deployment__how-to-enable-social-logins__004", "module": "10_deployment", "source_url": "https://docs.frappe.io/framework/v15/user/en/guides/deployment/how-to-enable-social-logins", "title": "How To Enable Social Logins", "section_heading": "GitHub", "content": "## GitHub\n\n1. Go to <https://github.com/settings/applications>\n2. Click on **Register new application**\n3. Fill the form with:\n\n* Homepage URL as **http://**\n* Authorization callback URL as\n  **http:///api/method/frappe.www.login.login\\\\_via\\\\_github**\n\n1. Click on Register application.\n2. Copy the generated Client ID and Client Secret into **Desktop > Website > Setup > Social Login Keys** and **Desktop > Integration > Authentication > Social Login Key > Client Secret**\n\n---\n\n### Office 365\n\n1. Go to <https://portal.azure.com>\n2. Create a new Azure Active Directory > App Registration.\n3. Click on New Application Registration\n4. Fill the form with:\n\n* Application Name\n* Select Accounts in any organizational directory (Any Azure AD directory - Multitenant).\n* Application Type - Web app / API\n* Redirect URI as\n* Homepage URL as **http://**\n* Authorization callback URL as **http:///api/method/frappe.integrations.oauth2\\_logins.login\\_via\\_office365**\n\n1. Click on Register application.\n2. Go to the section **Overview** in Azure Portal copy the Application (client) ID into \\*\\*Desktop > Integration > Authentication > Social Login Key > Client ID\n3. Go to the section **Certificates & secrets** in Azure Portal and create new client secrets copy than copy Client Secret by adding into **Desktop > Integration > Authentication > Social Login Key > Client Secret**\n4. Select Office 365 as Social Login Provider\n5. Click Enable Social Login and Save\n6. Go to the section **Token configuration** click add optional claim\n\n* Add Token Type > ID > Email\n\n---", "content_type": "prose", "has_code": false, "token_count": 390}
{"chunk_id": "10_deployment__guides__database-settings__setup-read-from-secondary-db__001", "module": "10_deployment", "source_url": "https://docs.frappe.io/framework/v15/user/en/guides/database-settings/setup-read-from-secondary-db", "title": "Setup Read From Secondary Db", "section_heading": "Steps to setup readonly environment", "content": "## Steps to setup readonly environment\n\nIn normal, the system does read and write operations on the same database. As data size increases or the number of concurrent activities increases, you may start facing a lag in operations.\n\nOne immediate solution to avoid such delay is, separate out the read and write activities, i.e. read all data from replica / secondary database and write all information to master / primary database.\n\nNow, in frappe, you can split read and write activities between master and replica.\n\n### Steps to setup readonly environment\n\n1. **Pre-requisites** :\n   You should have setup for [MariaDB Master-Slave](https://mariadb.com/kb/en/library/setting-up-replication/) or [Cluster](https://mariadb.com/kb/en/library/getting-started-with-mariadb-galera-cluster/) environment.\n2. **Configurations for read-only replica** :\n\nIn your site\\_config.json, add following keys to enable read from replica / secondary system.\n\n```python\n...\n\"read_from_replica\" : 1/0 # to enable disable read from replica\n\"different_credentials_for_replica\" : 1/0 #if database creadetials are different on replica then set 1 else 0\n\"replica_host\" : \"IP address for replica\" ,\n\"replica_db_port\" : \"Replica DB port\",\n\"replica_db_name\" : \"Replica DB name\",\n\"replica_db_password\" : \"Replica DB password\",\n...\n```\n\n**Note**: If you have enabled MariaDB master-replica environment, then DB name and DB password are same on both.\n\n3. [Grant access permissions](https://dev.mysql.com/doc/refman/8.0/en/grant.html) for master host on slave / secondary system.", "content_type": "mixed", "has_code": true, "token_count": 386}
{"chunk_id": "10_deployment__guides__database-settings__postgres-database-setup__001", "module": "10_deployment", "source_url": "https://docs.frappe.io/framework/v15/user/en/guides/database-settings/postgres-database-setup", "title": "Postgres Database Setup", "section_heading": "", "content": "Use following command to use Postgres as database for your new site.\n\n`bench new-site <site-name> --db-type postgres`\n\n**Note:** Make sure you have Postgres version 9 or greater installed in your system.", "content_type": "prose", "has_code": false, "token_count": 50}
